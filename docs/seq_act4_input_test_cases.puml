@startuml seq_act4_input_test_cases

title แผนภาพลำดับกิจกรรมที่ 4: การป้อนอินพุตเพื่อสร้างกรณีทดสอบ

participant ":PipelineController" as ctrl
participant ":TestDataGenerator" as gen
participant ":GeneratorPict" as pict
participant ":FileSystem" as fs

ctrl -> gen : 1 : generateTestData(manifestPath, constraints)
gen -> fs : 2 : readManifestJson(manifestPath)
fs --> gen : 3 : manifest {source, widgets[]}
gen -> pict : 4 : extractFactorsFromManifest(widgets)

loop [For each widget in manifest]
    alt [TextFormField]
        pict -> pict : 5.1 : factors[key] = [valid, invalid]
    else [Radio]
        pict -> pict : 5.2 : groupByBinding() — add option to group
    else [Dropdown]
        pict -> pict : 5.3 : extractOptionsFromMeta() — [opt1, opt2, ...]
    else [Checkbox]
        pict -> pict : 5.4 : factors[key] = [checked, unchecked]
    else [DatePicker]
        pict -> pict : 5.5 : generateDateValues(pickerMeta)
    else [TimePicker]
        pict -> pict : 5.6 : factors[key] = [09:00, 14:30, 18:00, null]
    end
end

pict --> gen : 6 : FactorExtractionResult {factors, requiredCheckboxes}

alt [Constraints file provided]
    gen -> fs : 7 : readConstraintsFile(constraintsPath)
    fs --> gen : 8 : constraint rules
end

gen -> pict : 9 : generatePictModel(factors, constraints)
pict --> gen : 10 : fullModelContent
gen -> pict : 11 : generateValidOnlyPictModel(factors, requiredCheckboxes)
pict --> gen : 12 : validModelContent
gen -> fs : 13 : writeModelFile(fullModelPath)
gen -> fs : 14 : writeModelFile(validModelPath)
fs --> gen : 15 : done

@enduml
