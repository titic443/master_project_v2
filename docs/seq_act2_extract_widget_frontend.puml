@startuml seq_act2_extract_widget_frontend

title แผนภาพลำดับกิจกรรมที่ 2: การสกัดวิดเจ็ตและข้อมูลเมตาจากไฟล์ฟรอนต์เอนด์

participant ":PipelineController" as ctrl
participant ":UiManifestExtractor" as ext
participant ":FileSystem" as fs

ctrl -> ext : 1 : extractManifest(filePath)
ext -> fs : 2 : readFileSync(filePath)
fs --> ext : 3 : rawSource
ext -> ext : 4 : _stripComments(rawSource)
ext -> ext : 5 : _collectStringConsts(source)
ext -> ext : 6 : _findPageClass(source)
ext -> ext : 7 : _findCubitType(source)
ext -> ext : 8 : _findStateType(source)
ext -> ext : 9 : _scanWidgets(source, consts, cubitType)

loop [For each widget match in source]
    ext -> ext : 10 : _extractKey(args, consts)

    alt [TextField / TextFormField]
        ext -> ext : 10.1 : _extractTextFieldMeta(args)
        ext -> ext : 10.2 : _extractValidationMeta(type, args)
    else [DropdownButton]
        ext -> ext : 10.3 : _extractValidationMeta() — extract options
    else [Radio]
        ext -> ext : 10.4 : _extractRadioMeta(args)
    else [Checkbox / Switch]
        ext -> ext : 10.5 : _extractValidationMeta() — extract binding
    end
end

ext -> ext : 11 : _scanDateTimePickers(rawSource)
ext -> ext : 12 : filterWidgetsWithKey()
ext -> ext : 13 : deduplicateByKey()
ext -> ext : 14 : linkPickerMetadata()
ext -> ext : 15 : sortBySequenceNumber()
ext -> fs : 16 : writeManifestJson(manifestPath)
fs --> ext : 17 : done
ext --> ctrl : 18 : return manifestPath

@enduml
