 Plan to implement                                                                                              │
│                                                                                                                │
│ Plan: Refactor extract_ui_manifest.dart ให้เป็น OOP เต็มรูปแบบ                                                     │
│                                                                                                                │
│ Context                                                                                                        │
│                                                                                                                │
│ ไฟล์ tools/script_v2/extract_ui_manifest.dart มี class UiManifestExtractor แต่เป็นแค่เปลือก — มีเพียง 2 methods        │
│ (extractManifest, _processOne) ส่วน logic จริงทั้งหมด 25 private functions เป็น top-level functions อยู่นอก class     │
│ ตั้งแต่ line 269 จนจบไฟล์                                                                                          │
│                                                                                                                │
│ เป้าหมาย: ย้าย 25 top-level functions ทั้งหมดเข้าไปเป็น private methods ของ UiManifestExtractor ให้เป็น OOP เต็มรูปแบบ   │
│ เหมือนที่ generator_pict.dart ทำได้ดีแล้ว                                                                            │
│                                                                                                                │
│ สิ่งที่ต้องตรวจสอบก่อน Refactor                                                                                      │
│                                                                                                                │
│ Public API ที่ต้องไม่เปลี่ยน                                                                                         │
│                                                                                                                │
│ - UiManifestExtractor class + extractManifest(path) method — ใช้โดย:                                            │
│   - webview/server.dart → import ... show UiManifestExtractor (line 53)                                        │
│   - tools/flutter_test_generator.dart → import ... as step1 แล้วเรียก step1.processUiFile()                      │
│ - processUiFile(path) top-level function — ยังต้องเก็บไว้เป็น backward-compatible wrapper                           │
│ - main() top-level function — ยังต้องเก็บไว้เป็น CLI entry point                                                    │
│                                                                                                                │
│ Top-level functions ที่ไม่มีใครเรียกจากภายนอก (safe to move)                                                        │
│                                                                                                                │
│ 25 private functions (_stripComments, _findPageClass, _scanWidgets, etc.) ทั้งหมดเป็น file-private (ขึ้นต้นด้วย _)    │
│ ไม่มีไฟล์อื่นเรียกใช้เลย — ปลอดภัยที่จะย้ายเข้า class                                                                      │
│                                                                                                                │
│ Class state                                                                                                    │
│                                                                                                                │
│ UiManifestExtractor ไม่มี fields ใดๆ (const UiManifestExtractor()) — ทุก function เป็น pure function ไม่ขึ้นกับ state  │
│ → ย้ายเข้า class ได้โดยไม่ต้องเพิ่ม fields                                                                            │
│                                                                                                                │
│ แผนการ Refactor                                                                                                │
│                                                                                                                │
│ ไฟล์ที่แก้ไข                                                                                                       │
│                                                                                                                │
│ - tools/script_v2/extract_ui_manifest.dart (ไฟล์เดียว)                                                           │
│                                                                                                                │
│ ขั้นตอน                                                                                                          │
│                                                                                                                │
│ 1. ย้าย 25 top-level functions เข้าไปใน class UiManifestExtractor                                                │
│   - ตัดทั้ง 25 functions (line 295–จบไฟล์) ออกจาก top-level                                                        │
│   - วางไว้หลัง _processOne() method ภายใน class body                                                             │
│   - เปลี่ยนจาก top-level _functionName เป็น class method _functionName (ชื่อเหมือนเดิม)                               │
│   - ไม่ต้องแก้ signature หรือ logic ภายใน เพราะทุก function เป็น pure function ไม่มี dependency กับ state               │
│                                                                                                                │
│ รายการ functions ที่ย้าย (เรียงตาม line number):                                                                   │
│ _stripComments(String s)                    → line 295                                                         │
│ _findPageClass(String src)                  → line 416                                                         │
│ _scanWidgets(src, {consts, cubitType})       → line 441                                                        │
│ _matchParen(String s, int openIdx)           → line 591                                                        │
│ _matchBrace(String s, int openIdx)           → line 637                                                        │
│ _extractKey(args, {consts})                  → line 693                                                        │
│ _extractOnTapMethod(String args)             → line 763                                                        │
│ _extractTextBinding(args, {consts})          → line 816                                                        │
│ _maybeTextLiteral(String args)               → line 850                                                        │
│ _extractTextFieldMeta(args, {regexVars})     → line 895                                                        │
│ _extractValidationMeta(widgetType, args)     → line 1079                                                       │
│ _collectRegexVars(String src)                → line 1340                                                       │
│ _collectStringConsts(String src)             → line 1376                                                       │
│ _findCubitType(String src)                   → line 1411                                                       │
│ _findStateType(String src)                   → line 1441                                                       │
│ _extractRadioMeta(String args)               → line 1475                                                       │
│ _collectRadioOptionMeta(String args)         → line 1512                                                       │
│ _extractSequence(String key)                 → line 1586                                                       │
│ _findCubitFilePath(src, cubitType)            → line 1617                                                      │
│ _findStateFilePath(src, stateType)            → line 1655                                                      │
│ _scanDateTimePickers(String src)             → line 1699                                                       │
│ _findContainingMethod(src, pos)              → line 1785                                                       │
│ _extractDatePickerParams(String args)        → line 1825                                                       │
│ _extractTimePickerParams(String args)        → line 1921                                                       │
│ _parseDateTimeArgs(String args)              → line 1975                                                       │
│ 2. คงเดิม 3 top-level items                                                                                     │
│   - main() — CLI entry point (line 44)                                                                         │
│   - processUiFile() — backward-compatible wrapper (line 65)                                                    │
│   - ทั้งคู่ยังคง delegate ไปที่ UiManifestExtractor().extractManifest()                                               │
│ 3. ลบ section comments ของ top-level ที่ไม่จำเป็นอีกแล้ว (เช่น /// COMMENT STRIPPING, /// PAGE METADATA EXTRACTION    │
│ ฯลฯ) — ย้ายไปจัดกลุ่มใหม่ภายใน class                                                                                │
│ 4. ตรวจสอบ const constructor — เนื่องจากทุก method เป็น pure function ไม่มี mutable state, class ยังคงเป็น const       │
│ UiManifestExtractor() ได้                                                                                       │
│                                                                                                                │
│ โครงสร้างหลัง Refactor                                                                                           │
│                                                                                                                │
│ // ── TOP-LEVEL (คงเดิม) ──                                                                                     │
│ void main(List<String> args) { ... }                                                                           │
│ String processUiFile(String path) => const UiManifestExtractor().extractManifest(path);                        │
│                                                                                                                │
│ // ── CLASS (OOP เต็มรูปแบบ) ──                                                                                  │
│ class UiManifestExtractor {                                                                                    │
│   const UiManifestExtractor();                                                                                 │
│                                                                                                                │
│   // --- Public API ---                                                                                        │
│   String extractManifest(String path) { ... }                                                                  │
│                                                                                                                │
│   // --- Core Processing ---                                                                                   │
│   void _processOne(String path) { ... }                                                                        │
│                                                                                                                │
│   // --- Comment Stripping ---                                                                                 │
│   String _stripComments(String s) { ... }                                                                      │
│                                                                                                                │
│   // --- Page Metadata ---                                                                                     │
│   String? _findPageClass(String src) { ... }                                                                   │
│   String? _findCubitType(String src) { ... }                                                                   │
│   String? _findStateType(String src) { ... }                                                                   │
│   String? _findCubitFilePath(String src, String? cubitType) { ... }                                            │
│   String? _findStateFilePath(String src, String? stateType) { ... }                                            │
│                                                                                                                │
│   // --- Widget Scanning ---                                                                                   │
│   List<Map<String, dynamic>> _scanWidgets(...) { ... }                                                         │
│   Map<String, Map<String, dynamic>> _scanDateTimePickers(String src) { ... }                                   │
│                                                                                                                │
│   // --- Key & Property Extraction ---                                                                         │
│   String? _extractKey(...) { ... }                                                                             │
│   String? _extractOnTapMethod(String args) { ... }                                                             │
│   Map<String, String>? _extractTextBinding(...) { ... }                                                        │
│   Map<String, dynamic> _maybeTextLiteral(String args) { ... }                                                  │
│   Map<String, dynamic> _extractTextFieldMeta(...) { ... }                                                      │
│   Map<String, dynamic> _extractValidationMeta(...) { ... }                                                     │
│   Map<String, dynamic> _extractRadioMeta(String args) { ... }                                                  │
│   List<Map<String, String>> _collectRadioOptionMeta(String args) { ... }                                       │
│                                                                                                                │
│   // --- Bracket Matching ---                                                                                  │
│   int _matchParen(String s, int openIdx) { ... }                                                               │
│   int _matchBrace(String s, int openIdx) { ... }                                                               │
│                                                                                                                │
│   // --- String & Const Collection ---                                                                         │
│   Map<String, String> _collectRegexVars(String src) { ... }                                                    │
│   Map<String, String> _collectStringConsts(String src) { ... }                                                 │
│                                                                                                                │
│   // --- Sorting ---                                                                                           │
│   int? _extractSequence(String key) { ... }                                                                    │
│                                                                                                                │
│   // --- Date/Time Picker ---                                                                                  │
│   String? _findContainingMethod(String src, int pos) { ... }                                                   │
│   Map<String, dynamic> _extractDatePickerParams(String args) { ... }                                           │
│   Map<String, dynamic> _extractTimePickerParams(String args) { ... }                                           │
│   String _parseDateTimeArgs(String args) { ... }                                                               │
│ }                                                                                                              │
│                                                                                                                │
│ Verification                                                                                                   │
│                                                                                                                │
│ 1. Static analysis: dart analyze tools/script_v2/extract_ui_manifest.dart — ต้องไม่มี errors                      │
│ 2. รัน CLI โดยตรง: dart run tools/script_v2/extract_ui_manifest.dart lib/demos/linkedin_profile_page.dart — ต้อง │
│  generate manifest ได้เหมือนเดิม                                                                                  │
│ 3. ตรวจ output: เปรียบเทียบ manifest JSON ก่อน/หลัง refactor — ต้องเหมือนกันทุกประการ    